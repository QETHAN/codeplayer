define(["jquery","infinitescroll","easing","scrollto"],function(e){return{init:function(){this.updown(),this.resList(),this.resDetail(),this.zjFindForm(),this.zjRespondForm(),this.resSearch()},resSearch:function(){e(document).on("focusin","#res-search-main",function(){e(this).closest(".search-command").addClass("focused")}),e(document).on("focusout","#res-search-main",function(){e(this).closest(".search-command").removeClass("focused")})},resList:function(){e(".zj-res-authed").hover(function(){e(this).tooltip("toggle")}),e(".ni-code-tip").hover(function(){e(this).popover("toggle")}),e(".hover-item").hover(function(){e(this).find(".res-meta").animate({opacity:"1"})},function(){e(this).find(".res-meta").animate({opacity:"0"})});var t=e(".res-lists").data("maxpage"),o=1;o++,t>1&&e("#res-list-pagination a").attr("href","/restaurant/index/index/p/"+o),e(".res-lists").infinitescroll({navSelector:"#res-list-pagination",nextSelector:"#res-list-pagination a",itemSelector:".res-item",debug:!0,animate:!0,extraScrollPx:200,bufferPx:40,errorCallback:function(){alert("error")},localMode:!0,dataType:"html",loading:{img:"/Public/img/assets/loader.gif",msgText:"",finishedMsg:"",selector:"#loading-block"}},function(s){var i=e(s);$hoverItem=i.find(".hover-item"),e(".res-list-wrapper").append(i),$hoverItem.hover(function(){e(this).find(".res-meta").animate({opacity:"1"})},function(){e(this).find(".res-meta").animate({opacity:"0"})}),o++,o>t?(e("#res-list-pagination").remove(),e(".res-lists").infinitescroll({state:{isDone:!0}})):e("##res-list-pagination a").attr("href","/restaurant/index/index/p/"+o)})},zjFindForm:function(){function t(t,o){"use strict";e(".message-text").html(o),e(".alert-message").removeClass("s f a").addClass(t).toggleClass("hide"),setTimeout(function(){e(".alert-message").toggleClass("hide")},2e3)}e("#find-form-submit").on("click",function(){var o=e("#res-location").val(),s=e("#res-address").val(),i=e("#res-name").val(),a=e("#nick-name").val(),n=e("#phone-num").val(),r=(e("#auth-code").val(),e("#gexing").val()),d=e("#wenhua").val(),l=e("#pinzhi").val(),c=[];if(""==i)return void t("a","请输入餐厅名字");if(""==o)return void t("a","请选择餐厅区域");if(""==a)return void t("a","请输入您的名字");if(""==n)return void t("a","请输入您的电话号码");if(""==r&&""==d&&""==l)return void t("a","请至少输入一项您的描述");if(""!==d){var f={star_id:1,star_story:d};c.push(f)}if(""!==l){var f={star_id:2,star_story:l};c.push(f)}if(""!==r){var f={star_id:3,star_story:r};c.push(f)}e.post("/service/operateExplore/doAddPreRestaurant",{author:a,area:o,address:s,rname:i,star_story:c},function(e){return 1==e?(t("s","提交成功"),void(location.href="/service/operateExplore/doAddSuccess")):0==e?void t("f","提交失败"):void 0})})},zjRespondForm:function(){function t(t,o){"use strict";e(".message-text").html(o),e(".alert-message").removeClass("s f a").addClass(t).toggleClass("hide"),setTimeout(function(){e(".alert-message").toggleClass("hide")},2e3)}e("#respond-form-submit").on("click",function(o){var s=e("#tel-num").val(),i=e("#advice").val();return""==s?void t("a","请输入您的联系方式"):""==i?void t("a","请输入您的意见"):(e.post("/service/operateFeedback/doAddFeedback",{detail:i,contact:s},function(e){if(200==e.code)console.log(200),window.location.href="/service/operateFeedback/doAddSuccess";else{if(400==e.code)return void t("f","表单信息不完整");if(500==e.code)return void t("f","提交失败")}}),void o.preventDefault())})},updown:function(){e("#updown .up").on("click",function(){e("html,body").stop().scrollTo(0,200)}),e("#updown .down").on("click",function(){var t=e(document).height();e("html,body").stop().scrollTo(t,200)}),e(window).scrollTop()>=100?e("#updown").fadeIn(300):e("#updown").fadeOut(300),e(window).scroll(function(){e(window).scrollTop()>=100?e("#updown").fadeIn(300):e("#updown").fadeOut(300)})},resDetail:function(){function t(t,o){"use strict";e(".message-text").html(o),e(".alert-message").removeClass("s f a").addClass(t).toggleClass("hide"),setTimeout(function(){e(".alert-message").toggleClass("hide")},2e3)}var o,s=e(window),i=e(document.body),a=e("#res-detail-trigger"),n=a.find("a");void 0!=a.offset()&&(o=a.offset().top),i.scrollspy({target:"#res-detail-trigger",offset:o}),s.on("load",function(){i.scrollspy("refresh")}),a.affix({offset:{top:function(){var e=a.offset().top+50;return this.top=e+50}}}),n.on("click",function(t){t.preventDefault();var o=e(this).attr("href");e("html,body").stop().scrollTo(o,500)}),e(".res-detail-zan").on("click",function(o){var s=e(this).parents(".imgtxt-block"),i=s.data("star-id"),a=s.data("r-id"),n=s.data("sd-id"),r=s.find(".fav-num-text").html(),d=e(this);e.post("/restaurant/operate/doIncStarVote",{r_id:a,star_id:i,sd_id:n},function(e){if(1==e){var o=parseInt(r)+1;d.parents(".imgtxt-block").find(".fav-num-text").html(o),t("s","赞成功"),d.addClass("disabled"),d.html("已赞")}else 0==e?t("f","赞失败"):2==e&&t("a","您今天这项已经赞过了，不能重复再赞了")}),o.preventDefault()})}}});