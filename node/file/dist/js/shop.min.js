!function(e){function t(e){var n=e.offsetTop;return null!=e.offsetParent&&(n+=t(e.offsetParent)),n}function n(t){e.get(app.DU+app.DI.querySubRegion+t,function(t){var t=JSON.parse(t),n=f(t);g.innerHTML=n,e.get(app.DU+app.DI.querySubRegion+t.sub_region[0].region_id,function(e){var e=JSON.parse(e);if(0==e.sub_region.length)v.parentNode.style.display="none";else{v.parentNode.style.display="";var t=f(e);v.innerHTML=t}})})}function o(){var e=h.value,t=I.value,n=E.value,o=b.value,l=w.value,c=B.value,d=x.value,s=L.value,r=T.value,i=(_.textContent,M.value),m=k.value;if(0==e.replace(/^(\s+)|(\s+)$/g,"").length){for(var p=0;H>p;p++)D[p].style.display="none";return void(N.style.display="block")}if(0==t.replace(/^(\s+)|(\s+)$/g,"").length){for(var p=0;H>p;p++)D[p].style.display="none";return void(O.style.display="block")}if(0==d.replace(/^(\s+)|(\s+)$/g,"").length){for(var p=0;H>p;p++)D[p].style.display="none";return void(A.style.display="block")}for(var p=0;H>p;p++)D[p].style.display="none";"none"==v.parentNode.style.display&&(c=""),S={name:e,cellphone:t,telephone:n,province:o,city:l,area:c,address:d,oc_id:s,count:r,total_account:39.5*parseInt(r,10),c_remark:i,from:m},q.style.display="block",U.style.display="block",U.className+=" cmc-show",$.textContent="确认订单",G=F(S),z.innerHTML=G,a(),document.documentElement.scrollTop=u}function l(){count.selectedIndex=0,total_account.textContent="79元",h.value="",I.value="",E.value="",x.value="",M.value=""}function c(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}function d(e){for(var t=Y.length;t--;)if(e.keyCode===Y[t])return void c(e)}function s(e){c(e)}function a(){window.addEventListener&&window.addEventListener("DOMMouseScroll",s,!1),window.onmousewheel=document.onmousewheel=s,document.onkeydown=d}function r(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",s,!1),window.onmousewheel=document.onmousewheel=document.onkeydown=null}e("#camera_wrap_1").camera({height:"400px",loader:"bar",pagination:!1,thumbnails:!0}),e("#camera_wrap_2").camera({height:"400px",loader:"bar",pagination:!1,thumbnails:!0});var i=document.getElementById("shop-nav"),m=t(i),u=0;window.onscroll=function(){u=document.documentElement.scrollTop||document.body.scrollTop,u>m?(i.style.position="fixed",i.style.top="0px",i.style.marginTop="0px",i.style.backgroundColor="#fff",i.style.zIndex=10,i.style.cssText+="-webkit-box-shadow: rgba(0, 0, 0, 0.3) 0px 2px 1px;-moz-box-shadow: rgba(0, 0, 0, 0.3) 0px 2px 1px;box-shadow: rgba(0, 0, 0, 0.3) 0px 2px 1px;"):(i.style.cssText="",i.style.position="static",i.style.marginTop="30px")};var p=document.getElementById("province"),y=Handlebars.compile(document.getElementById("province-tpl").innerHTML),g=document.getElementById("subRegion1"),v=document.getElementById("subRegion2"),f=Handlebars.compile(document.getElementById("sub-option-tpl").innerHTML),h=document.getElementById("name"),I=document.getElementById("cellphone"),E=document.getElementById("telephone"),b=document.getElementById("province"),w=document.getElementById("subRegion1"),B=document.getElementById("subRegion2"),x=document.getElementById("address"),L=document.getElementById("oc_id"),T=document.getElementById("count"),_=document.getElementById("total_account"),M=document.getElementById("c_remark"),k=document.getElementById("from"),D=document.getElementById("form-error").querySelectorAll("li"),H=D.length,C=document.querySelectorAll(".cancelbuy"),S=null;e.get(app.DU+app.DI.queryProvince,function(e){var e=JSON.parse(e),t=y(e);p.innerHTML=t,n(e.province[0].region_id)}),p.onchange=function(){n(this.options[this.selectedIndex].getAttribute("data-id"))},g.onchange=function(){e.get(app.DU+app.DI.querySubRegion+this.options[this.selectedIndex].getAttribute("data-id"),function(e){var e=JSON.parse(e);if(0==e.sub_region.length)v.style.display="none";else{v.style.display="";var t=f(e);v.innerHTML=t}})};var N=(document.getElementById("buyform"),document.getElementById("name-error")),O=document.getElementById("phone-error"),A=document.getElementById("address-error"),R=document.getElementById("addOrder"),q=document.getElementById("confirmModal"),U=document.getElementById("confirm"),J=document.getElementById("success"),P=document.getElementById("fail"),$=document.getElementById("confirm-header"),z=document.getElementById("confirm-cmc"),j=document.getElementById("success-cmc"),Q=document.getElementById("fail-cmc"),V=document.getElementById("confirmbuy"),F=Handlebars.compile(document.getElementById("addConfirm-tpl").innerHTML),G=(document.getElementById("confirmAction"),null),K=document.getElementById("success-title"),W=document.getElementById("success-msg");R.onclick=function(){o()};for(var X=0;X<C.length;X++)C[X].onclick=function(){q.style.display="none",U.classList.remove("cmc-show"),J.classList.remove("cmc-show"),P.classList.remove("cmc-show"),U.classList.remove("cmc-hide"),J.classList.remove("cmc-hide"),P.classList.remove("cmc-hide"),K.textContent="提交成功",W.textContent="订单提交成功，订单号、售后联系方式稍后短信通知你 ~",V.removeAttribute("disabled"),r()};V.onclick=function(){$.textContent="订单提交中...",V.setAttribute("disabled","disabled"),e.post(app.DU+app.DI.addOrder,S,function(e){var e=JSON.parse(e);e.order_num?(U.classList.remove("cmc-show"),U.classList.add("cmc-hide"),j.innerHTML=G,K.textContent="提交成功",W.textContent="订单提交成功，订单号、售后联系方式稍后短信通知你 ~",J.classList.add("cmc-show"),l()):(U.classList.remove("cmc-show"),U.classList.add("cmc-hide"),j.innerHTML=G,K.textContent="库存不足",W.textContent="这批咖啡已经被吃货们买完了，下一批到货挑嘴师会通知你哒 ~",J.classList.add("cmc-show"),l())}).fail(function(){U.classList.remove("cmc-show"),U.classList.add("cmc-hide"),Q.innerHTML=G,P.classList.add("cmc-show")})};var Y=[37,38,39,40];console.log("------------>"+app.DU)}(jQuery);