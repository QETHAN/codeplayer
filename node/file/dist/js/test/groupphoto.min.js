define(["jquery"],function(t){return{photo:function(){function e(t,e,a){var n,i,r,o,s,f,c,u,m;return s=t.offset(),n=s.left,r=s.top,i=n+t.outerWidth(),o=r+t.outerHeight(),f=e>i?i:e>n?e:n,c=a>o?o:a>r?a:r,u=Math.abs(f-e),m=Math.abs(c-a),Math.sqrt(u*u+m*m)}function a(e){for(var a=e.pageX,i=e.pageY,r=-1,o=t([]);o[0]=n[++r];)o.triggerHandler("proximity",[a,i])}var n=t([]),i=t(document);t.event.special.proximity={defaults:{max:100,min:0,throttle:0,fireOutOfBounds:1},setup:function(){n[0]||i.mousemove(a),n=n.add(this)},add:function(a){var n=a.handler,i=t.extend({},t.event.special.proximity.defaults,a.data),r=0,o=0,s=t(this);a.handler=function(t,a,f){var c,u,m,l=i.max,p=i.min,d=i.throttle,h=+new Date,x=i.fireOutOfBounds;if(!(d&&r+d>h)&&(r=h,c=e(s,a,f),m=l>c&&c>p,x||m)){if(m)o=0;else{if("number"==typeof x&&o>x)return;++o}return u=t.proximity=1-(l>c?p>c?0:c/l:1),t.distance=c,t.pageX=a,t.pageY=f,t.data=i,n.call(this,t,u,c)}}},teardown:function(){n=n.not(this),n[0]||i.unbind("mousemove",a)}};var r=function(){var e=t("#pe-thumbs"),a=e.width(),n=e.offset().left,i=e.find("img"),r=e.find("div.pe-description"),o={maxScale:.9,maxOpacity:1,minOpacity:Number(i.css("opacity"))},s=function(){o.minScale=f(),m(function(){c(),u()})},f=function(){var t=window.getComputedStyle(i.get(0),null),e=t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("transform")||"fail...";if("none"!==e){{var a=e.split("(")[1].split(")")[0].split(","),n=a[0],r=a[1];a[2],a[3]}return Math.sqrt(n*n+r*r)}},c=function(){r.each(function(){var e=t(this),a=e.prev(),n=a.width(),i=a.height(),r=o.maxScale*n,s=o.maxScale*i,f=(s-i)/2,c=(r-n)/2;e.data("space_l",c).css({height:o.maxScale*e.height(),top:-f,left:r-c})})},u=function(){i.on("proximity.Photo",{max:150,min:0,throttle:0,fireOutOfBounds:3},function(e,i){var r=t(this),s=r.closest("li"),f=r.next(),c=i*(o.maxScale-o.minScale)+o.minScale,u="scale("+c+")",f=r.next();c===o.maxScale?(s.css("z-index",1e3),f.offset().left+f.width()>n+a&&f.css("left",-f.width()-f.data("space_l")),f.fadeIn(100)):(s.css("z-index",1),f.stop(!0,!0).hide()),r.css({"-webkit-transform":u,"-moz-transform":u,"-o-transform":u,"-ms-transform":u,transform:u,opacity:i*(o.maxOpacity-o.minOpacity)+o.minOpacity})})},m=function(e){var a=0,n=i.length;i.each(function(){var i=t(this);t("<img/>").load(function(){++a,a===n&&e.call()}).attr("src",i.attr("src"))})};return{init:s}}();r.init()}}});